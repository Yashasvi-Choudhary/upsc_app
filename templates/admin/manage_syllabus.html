<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Manage Syllabus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Confirm delete prompt
      function confirmDelete(syllabusId) {
        if (confirm("Are you sure you want to delete this syllabus?")) {
          document.getElementById("delete-form-" + syllabusId).submit();
        }
      }

      // Enable inputs for editing
      function enableEdit(rowId) {
        const row = document.getElementById("row-" + rowId);
        row
          .querySelectorAll("input")
          .forEach((input) => input.removeAttribute("readonly"));
        row.querySelector(".edit-btn").style.display = "none";
        row.querySelector(".save-btn").style.display = "inline-block";
        row.querySelector(".cancel-btn").style.display = "inline-block";
      }

      // Cancel edit, revert inputs to readonly
      function cancelEdit(rowId) {
        const row = document.getElementById("row-" + rowId);
        row.querySelectorAll("input").forEach((input) => {
          input.setAttribute("readonly", true);
        });
        row.querySelector(".edit-btn").style.display = "inline-block";
        row.querySelector(".save-btn").style.display = "none";
        row.querySelector(".cancel-btn").style.display = "none";
      }

      // Case-insensitive search/filter
      function filterTable() {
        const input = document.getElementById("searchInput");
        const filter = input.value.toLowerCase();
        const table = document.getElementById("syllabusTable");
        const trs = table.querySelectorAll("tbody tr:not(#addRow)");

        trs.forEach((tr) => {
          // Concatenate all text input values in the row
          const textContent = Array.from(tr.querySelectorAll("input"))
            .map((input) => input.value.toLowerCase())
            .join(" ");

          if (textContent.includes(filter)) {
            tr.style.display = "";
          } else {
            tr.style.display = "none";
          }
        });
      }
    </script>
  </head>
  <body class="bg-gray-50 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
      <!-- Header with back button -->
      <div class="flex items-center space-x-4 mb-4">
        <a
          href="{{ url_for('admin.dashboard') }}"
          class="text-blue-600 hover:text-blue-800 font-semibold text-lg flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 inline"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 19l-7-7 7-7"
            />
          </svg>
         
        </a>
        <h1 class="text-3xl font-bold flex-grow">Manage Syllabus</h1>
      </div>

      <!-- Search and Add row -->
      <div
        class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 space-y-3 md:space-y-0"
      >
        <input
          id="searchInput"
          type="text"
          placeholder="Search syllabus..."
          onkeyup="filterTable()"
          class="w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button
          onclick="document.getElementById('addRow').style.display='table-row'; this.style.display='none'; document.getElementById('searchInput').value=''; filterTable();"
          class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-md font-semibold whitespace-nowrap"
        >
          Add New Syllabus
        </button>
      </div>

      <table
        id="syllabusTable"
        class="min-w-full bg-white shadow-md rounded-lg table-auto border-collapse"
      >
        <thead class="bg-gray-100 text-gray-700 uppercase text-sm select-none">
          <tr>
            <th class="border px-4 py-3">Exam Type</th>
            <th class="border px-4 py-3">Paper Type</th>
            <th class="border px-4 py-3">Year</th>
            <th class="border px-4 py-3">Link</th>
            <th class="border px-4 py-3 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Add New Syllabus Row (Initially Hidden) -->
          <tr id="addRow" style="display: none; background-color: #f0fdf4">
            <form method="POST" action="{{ url_for('admin.add_syllabus') }}">
              <td class="border px-4 py-2">
                <input
                  name="exam_type"
                  type="text"
                  required
                  class="w-full border rounded px-2 py-1"
                />
              </td>
              <td class="border px-4 py-2">
                <input
                  name="paper_type"
                  type="text"
                  required
                  class="w-full border rounded px-2 py-1"
                />
              </td>
              <td class="border px-4 py-2">
                <input
                  name="year"
                  type="number"
                  min="1900"
                  max="2100"
                  required
                  class="w-full border rounded px-2 py-1"
                />
              </td>
              <td class="border px-4 py-2">
                <input
                  name="link"
                  type="url"
                  required
                  class="w-full border rounded px-2 py-1"
                />
              </td>
              <td class="border px-4 py-2 text-center">
                <button
                  type="submit"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md font-semibold mr-2"
                >
                  Add
                </button>
                <button
                  type="button"
                  onclick='document.getElementById("addRow").style.display="none"; document.querySelector("button.bg-green-600").style.display="inline-block";'
                  class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-1 rounded-md font-semibold"
                >
                  Cancel
                </button>
              </td>
            </form>
          </tr>

          <!-- Existing syllabus rows -->
          {% for syllabus in syllabi %}
          <tr id="row-{{ syllabus.id }}" class="hover:bg-gray-50">
            <form
              method="POST"
              action="{{ url_for('admin.edit_syllabus', syllabus_id=syllabus.id) }}"
            >
              <td class="border px-4 py-2">
                <input
                  name="exam_type"
                  type="text"
                  value="{{ syllabus.exam_type }}"
                  readonly
                  class="w-full bg-transparent border-none focus:outline-none"
                />
              </td>
              <td class="border px-4 py-2">
                <input
                  name="paper_type"
                  type="text"
                  value="{{ syllabus.paper_type }}"
                  readonly
                  class="w-full bg-transparent border-none focus:outline-none"
                />
              </td>
              <td class="border px-4 py-2">
                <input
                  name="year"
                  type="number"
                  min="1900"
                  max="2100"
                  value="{{ syllabus.year }}"
                  readonly
                  class="w-full bg-transparent border-none focus:outline-none"
                />
              </td>
              <td class="border px-4 py-2">
                <input
                  name="link"
                  type="url"
                  value="{{ syllabus.link }}"
                  readonly
                  class="w-full bg-transparent border-none focus:outline-none truncate"
                  title="{{ syllabus.link }}"
                />
              </td>
              <td class="border px-4 py-2 text-center whitespace-nowrap">
                <button
                  type="button"
                  onclick="enableEdit('{{ syllabus.id }}')"
                  class="edit-btn bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded-md font-semibold mr-2"
                >
                  Edit
                </button>
                <button
                  type="submit"
                  style="display: none"
                  class="save-btn bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md font-semibold mr-2"
                >
                  Save
                </button>
                <button
                  type="button"
                  onclick="cancelEdit('{{ syllabus.id }}')"
                  style="display: none"
                  class="cancel-btn bg-gray-400 hover:bg-gray-500 text-white px-3 py-1 rounded-md font-semibold mr-2"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onclick="confirmDelete('{{ syllabus.id }}')"
                  class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md font-semibold"
                >
                  Delete
                </button>
              </td>
            </form>
            <form
              id="delete-form-{{ syllabus.id }}"
              method="POST"
              action="{{ url_for('admin.delete_syllabus', syllabus_id=syllabus.id) }}"
            ></form>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center py-4 text-gray-500">
              No syllabi found.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </body>
</html>
