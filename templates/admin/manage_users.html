<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Manage Users | Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 min-h-screen p-6">
    <header class="flex items-center space-x-4 mb-10 mt-6">
      <!-- Back button only icon -->
      <a
        href="/admin/dashboard"
        class="p-2 rounded hover:bg-gray-200 transition cursor-pointer"
        aria-label="Back to dashboard"
        title="Back to dashboard"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-7 w-7 text-blue-600 hover:text-blue-800"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </a>

      <h1 class="text-3xl font-bold text-gray-800">Manage Users</h1>
    </header>

    <div class="overflow-x-auto bg-white shadow-lg rounded-lg">
      <table
        class="min-w-full table-auto border-collapse text-gray-700"
        id="usersTable"
      >
        <thead
          class="bg-gray-100 uppercase text-sm font-semibold text-gray-600"
        >
          <tr>
            <th class="px-6 py-3 border-b border-gray-300">ID</th>
            <th class="px-6 py-3 border-b border-gray-300">Email</th>
            <th class="px-6 py-3 border-b border-gray-300">Username</th>
            <th class="px-6 py-3 border-b border-gray-300">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr
            data-user-id="{{ user.id }}"
            class="hover:bg-blue-50 transition-colors duration-200 border-b border-gray-200"
          >
            <td class="px-6 py-4">{{ user.id }}</td>
            <td class="px-6 py-4 break-all">{{ user.email }}</td>
            <td class="px-6 py-4">{{ user.username or 'N/A' }}</td>
            <td class="px-6 py-4">
              <button
                onclick="deleteUser('{{ user.id }}')"
                class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-md transition duration-150"
                type="button"
              >
                Delete
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <script>
      async function deleteUser(userId) {
        if (!confirm("Are you sure you want to delete this user?")) {
          return;
        }

        try {
          const response = await fetch(`/admin/delete-user/${userId}`, {
            method: "POST",
            headers: {
              "X-Requested-With": "XMLHttpRequest",
              "Content-Type": "application/json",
            },
            body: JSON.stringify({}), // empty body or CSRF token if needed
          });

          const result = await response.json();

          if (result.success) {
            const row = document.querySelector(`tr[data-user-id='${userId}']`);
            if (row) row.remove();
            alert(result.message || "User deleted successfully.");
          } else {
            alert(result.message || "Failed to delete user. Try again.");
          }
        } catch (error) {
          alert("Error occurred. Try again later.");
          console.error(error);
        }
      }
    </script>
  </body>
</html>
