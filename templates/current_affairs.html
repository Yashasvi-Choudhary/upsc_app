{% extends "base.html" %} {% block title %}Current Affairs - UPSC Aspirant{%
endblock %} {% block content %}
<div class="bg-gray-100 min-h-screen">
  <main class="container mx-auto px-4 py-6">
    <!-- Categories Navbar -->
    <nav class="bg-white rounded-lg shadow-md p-4 mb-6 sticky top-0 z-10">
      <div class="flex flex-col md:flex-row items-center justify-between">
        <div class="overflow-x-auto w-full md:w-auto pb-3 md:pb-0">
          <div class="flex flex-nowrap gap-2 min-w-max">
            <a
              href="{{ url_for('current_affairs') }}"
              class="px-4 py-2 rounded-md text-sm font-medium transition-colors {{ 'bg-blue-600 text-white' if active_category == 'all' else 'text-gray-700 hover:bg-gray-100' }}"
            >
              All
            </a>
            {% for category in categories %}
            <a
              href="{{ url_for('current_affairs', category=category) }}"
              class="px-4 py-2 rounded-md text-sm font-medium transition-colors {{ 'bg-blue-600 text-white' if active_category == category else 'text-gray-700 hover:bg-gray-100' }}"
            >
              {{ category|title }}
            </a>
            {% endfor %}
          </div>
        </div>

        <!-- Search -->
        <form
          action="{{ url_for('search') }}"
          method="get"
          class="flex w-full md:w-auto mt-3 md:mt-0"
        >
          <input
            type="text"
            name="query"
            placeholder="Search news..."
            class="border rounded-l-md px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
            required
          />
          <button
            type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded-r-md hover:bg-blue-700 transition-colors"
          >
            <i class="fas fa-search"></i>
          </button>
        </form>
      </div>
    </nav>

    <!-- Carousel -->
    <div class="relative mb-8 bg-white rounded-lg shadow-md overflow-hidden">
      <div class="carousel flex overflow-hidden h-64 md:h-96" id="newsCarousel">
        {% for article in carousel_items %}
        <div
          class="carousel-item relative min-w-full transition-opacity duration-300"
        >
          
          <div
            class="absolute inset-0 flex flex-col justify-end bg-gradient-to-t from-black via-black/70 to-transparent p-6"
          >
            <div class="text-white">
              <span
                class="bg-blue-600 text-white text-xs font-medium px-2.5 py-0.5 rounded"
              >
                {{ article.source.name if article.source and article.source.name
                else 'News' }}
              </span>
              <h2 class="text-xl md:text-2xl font-bold mt-2">
                {{ article.title }}
              </h2>
              <p class="text-gray-200 mt-2 line-clamp-2">
                {{ article.description }}
              </p>
              <a
                href="{{ article.url }}"
                target="_blank"
                class="inline-block mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors"
                >Read More</a
              >
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      <!-- Carousel indicators -->
      <div
        class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2"
      >
        {% for i in range(carousel_items|length) %}
        <button
          class="w-3 h-3 rounded-full bg-white/50 transition-colors carousel-indicator"
          data-index="{{ loop.index0 }}"
          aria-label="Slide {{ loop.index }}"
        ></button>
        {% endfor %}
      </div>
      <!-- Carousel buttons -->
      <button
        class="absolute top-1/2 left-4 -translate-y-1/2 bg-white/70 p-2 rounded-full shadow hover:bg-white transition-colors"
        id="prevBtn"
        aria-label="Previous slide"
      >
        <i class="fas fa-chevron-left text-gray-800"></i>
      </button>
      <button
        class="absolute top-1/2 right-4 -translate-y-1/2 bg-white/70 p-2 rounded-full shadow hover:bg-white transition-colors"
        id="nextBtn"
        aria-label="Next slide"
      >
        <i class="fas fa-chevron-right text-gray-800"></i>
      </button>
    </div>

    <!-- Latest News -->
    <section class="mb-10">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Latest News</h2>
        <a
          href="{{ url_for('view_bookmarks') }}"
          class="text-blue-600 hover:text-blue-800 flex items-center gap-2"
        >
          <i class="fas fa-bookmark"></i>
          <span>Saved News</span>
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for article in card_items %}
        <div
          class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow h-full flex flex-col"
        >
          <div class="relative h-48 overflow-hidden">
            
            <div class="absolute top-0 right-0 m-2">
              <button
                onclick="toggleBookmark(this, '{{ article.url }}')"
                data-article="{{ article|tojson|safe }}"
                class="bg-white/80 hover:bg-white p-2 rounded-full transition-colors bookmark-btn"
                aria-label="Bookmark article"
              >
                <i
                  class="fas {{ 'fa-bookmark text-blue-600' if article.url in bookmarks|map(attribute='url')|list else 'fa-bookmark text-gray-400' }}"
                ></i>
              </button>
            </div>
            <div class="absolute bottom-0 left-0 m-2">
              <span
                class="bg-blue-600 text-white text-xs font-medium px-2.5 py-0.5 rounded"
              >
                {{ article.source.name if article.source and article.source.name
                else 'News' }}
              </span>
            </div>
          </div>
          <div class="p-4 flex flex-col flex-grow">
            <h3 class="text-lg font-semibold mb-2 line-clamp-2">
              {{ article.title }}
            </h3>
            <p class="text-sm text-gray-600 mb-4 flex-grow line-clamp-3">
              {{ article.description }}
            </p>
            <div
              class="flex justify-between items-center mt-auto pt-2 border-t border-gray-100"
            >
              <a
                href="{{ article.url }}"
                target="_blank"
                class="text-sm bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
                >Read More</a
              >
              <span class="text-xs text-gray-500"
                >{{ article.publishedAt.split('T')[0] if article.publishedAt
                else '' }}</span
              >
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- Compilation Section -->
    <section class="mb-10">
      <h2 class="text-2xl font-bold mb-6 text-gray-800">
        UPSC Current Affairs Compilation
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
        <div
          class="bg-white rounded-lg shadow-md overflow-hidden group hover:shadow-lg transition-shadow"
        >
          <div class="bg-blue-600 h-2 w-full"></div>
          <div class="p-6 text-center">
            <div
              class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-calendar-week text-blue-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">Weekly Compilation</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Stay updated with this week's most important news events
            </p>
            <a
              href="{{ url_for('CA_compilation', period='weekly') }}"
              class="inline-block w-full bg-gray-100 text-blue-600 px-4 py-2 rounded hover:bg-blue-600 hover:text-white transition-colors"
              >View Weekly</a
            >
          </div>
        </div>
        <div
          class="bg-white rounded-lg shadow-md overflow-hidden group hover:shadow-lg transition-shadow"
        >
          <div class="bg-green-600 h-2 w-full"></div>
          <div class="p-6 text-center">
            <div
              class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-calendar-alt text-green-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">Monthly Compilation</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Get a comprehensive monthly news digest for your studies
            </p>
            <a
              href="{{ url_for('CA_compilation', period='monthly') }}"
              class="inline-block w-full bg-gray-100 text-green-600 px-4 py-2 rounded hover:bg-green-600 hover:text-white transition-colors"
              >View Monthly</a
            >
          </div>
        </div>
        <div
          class="bg-white rounded-lg shadow-md overflow-hidden group hover:shadow-lg transition-shadow"
        >
          <div class="bg-purple-600 h-2 w-full"></div>
          <div class="p-6 text-center">
            <div
              class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-calendar-check text-purple-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">Yearly Compilation</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Complete annual current affairs summary for UPSC preparation
            </p>
            <a
              href="{{ url_for('CA_compilation', period='yearly') }}"
              class="inline-block w-full bg-gray-100 text-purple-600 px-4 py-2 rounded hover:bg-purple-600 hover:text-white transition-colors"
              >View Yearly</a
            >
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  // Carousel functionality
  let currentSlide = 0;
  const carousel = document.getElementById("newsCarousel");
  const slides = document.querySelectorAll(".carousel-item");
  const totalSlides = slides.length;
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const indicators = document.querySelectorAll(".carousel-indicator");

  function showSlide(index) {
    if (index < 0) index = totalSlides - 1;
    if (index >= totalSlides) index = 0;

    // Update current slide
    currentSlide = index;

    // Update carousel position
    carousel.scrollLeft = slides[index].offsetLeft;

    // Update indicators
    indicators.forEach((indicator, i) => {
      if (i === currentSlide) {
        indicator.classList.add("bg-white");
        indicator.classList.remove("bg-white/50");
      } else {
        indicator.classList.remove("bg-white");
        indicator.classList.add("bg-white/50");
      }
    });
  }

  // Event listeners for controls
  prevBtn.addEventListener("click", () => showSlide(currentSlide - 1));
  nextBtn.addEventListener("click", () => showSlide(currentSlide + 1));

  // Setup indicator clicks
  indicators.forEach((indicator, index) => {
    indicator.addEventListener("click", () => showSlide(index));
  });

  // Auto-play carousel
  let carouselInterval = setInterval(() => showSlide(currentSlide + 1), 5000);

  // Pause carousel on hover
  carousel.addEventListener("mouseenter", () =>
    clearInterval(carouselInterval)
  );
  carousel.addEventListener("mouseleave", () => {
    carouselInterval = setInterval(() => showSlide(currentSlide + 1), 5000);
  });

  // Initialize first slide
  showSlide(0);

  // Bookmark functionality
  function toggleBookmark(button, url) {
    const article = JSON.parse(button.getAttribute("data-article"));
    const icon = button.querySelector("i");

    // Add loading state
    button.disabled = true;
    icon.classList.add("fa-spin");

    fetch("/bookmark", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(article),
    })
      .then((response) => response.json())
      .then((data) => {
        // Remove loading state
        button.disabled = false;
        icon.classList.remove("fa-spin");

        if (data.action === "added") {
          icon.classList.add("text-blue-600");
          icon.classList.remove("text-gray-400");
        } else {
          icon.classList.remove("text-blue-600");
          icon.classList.add("text-gray-400");
        }

        // Show notification
        showNotification(
          data.action === "added"
            ? "Article saved to bookmarks"
            : "Article removed from bookmarks",
          data.action === "added" ? "success" : "info"
        );
      })
      .catch((error) => {
        // Handle error
        button.disabled = false;
        icon.classList.remove("fa-spin");
        showNotification("Failed to update bookmark", "error");
        console.error("Error:", error);
      });
  }

  // Notification function
  function showNotification(message, type = "info") {
    // Create notification element
    const notification = document.createElement("div");

    // Set classes based on type
    let bgColor = "bg-blue-500";
    let icon = "fa-info-circle";

    if (type === "success") {
      bgColor = "bg-green-500";
      icon = "fa-check-circle";
    } else if (type === "error") {
      bgColor = "bg-red-500";
      icon = "fa-exclamation-circle";
    }

    // Set notification content and styling
    notification.className = `fixed bottom-4 right-4 ${bgColor} text-white px-4 py-3 rounded-md shadow-lg flex items-center transition-opacity duration-300 z-50`;
    notification.innerHTML = `
      <i class="fas ${icon} mr-2"></i>
      <span>${message}</span>
    `;

    // Add to document
    document.body.appendChild(notification);

    // Remove after 3 seconds
    setTimeout(() => {
      notification.style.opacity = "0";
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 300);
    }, 3000);
  }
</script>
{% endblock %}
